<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <div id="slideshow"></div>

    <!-- For style testing on desktop and mobile) -->
    <!-- <video autoplay muted controls src='./assets-cities/1.mp4'></video> -->
    <!-- <video autoplay muted controls src='./assets-cities/2.mp4'></video> -->

    <script type="module">
        const $ = document.querySelector.bind(document);
        const $$ = document.querySelectorAll.bind(document); // optional for multiple elements

        import { preloadImage, sleep, playVideo, addGoToFullscreenButton } from "./utils.js";

        addGoToFullscreenButton();

        // Images - https://www.pexels.com/search/big%20size/
        // Videos - https://www.pexels.com/video
        const slides = [
            {
                image: "https://images.pexels.com/photos/378570/pexels-photo-378570.jpeg",
                duration: 3000
            },
            {
                // video: "https://github.com/RagaTime/ragatime-files/blob/main/slideshow-assets/cities/1.mp4?raw=true",
                // video: './asset-videos/1.mp4', // For video urls of local video file
                video: "https://files.mypot.in/slideshow-assets/cities/1.mp4",
                duration: null // videos play as long as they have not ended
            },
            {
                image: "https://images.pexels.com/photos/460672/pexels-photo-460672.jpeg",
                duration: 3000
            },
            {
                // video: './asset-videos/2.mp4', // For video urls of local video file
                video: "https://files.mypot.in/slideshow-assets/cities/2.mp4",
                duration: null // videos play as long as they have not ended
            },
            {
                image: "https://images.pexels.com/photos/1388069/pexels-photo-1388069.jpeg",
                duration: 3000
            },
            {
                image: "https://images.pexels.com/photos/672532/pexels-photo-672532.jpeg",
                duration: 3000
            }
        ];

        main();
        async function main() {
            // Preload images
            for (const i in slides) { if (slides[i].image) { slides[i].image = await preloadImage(slides[i].image); } }
            // Learn: Use below statement to parallely load images
            // const loadedImgs = await Promise.all(slides.map(s => s.image).map(preloadImage)); for (const i in slides) { slides[i].image = loadedImgs[i]; }
            // console.log("üöÄ ~ loadedImgs:", loadedImgs);
            console.log("All images loaded ‚úÖ", slides.map(s => s.image));
            const container = $("#slideshow");
            let current = 0;
            const defaultDelay = 4000;
            let paused = false;

            // Create control buttons
            const controls = document.createElement("div");
            controls.className = 'slideshow-controls-container';
            controls.innerHTML = `
        <button id="prevBtn">‚èÆÔ∏è</button>
        <button id="pauseBtn">‚è∏Ô∏è</button>
        <button id="nextBtn">‚è≠Ô∏è</button>
    `;
            document.body.prepend(controls);

            // Event handlers
            $("#prevBtn").addEventListener("click", () => {
                current = (current - 1 + slides.length) % slides.length;
                // paused = true; // Use this option if you want to pause on click on "Next" button
                showSlide();
            });
            $("#pauseBtn").addEventListener("click", () => {
                console.log('paused-before?', paused);
                paused = !paused;
                console.log('paused-after?', paused);
                pauseBtn.textContent = paused ? "‚ñ∂Ô∏è" : "‚è∏Ô∏è";
            });
            $("#nextBtn").addEventListener("click", () => {
                current = (current + 1) % slides.length;
                // paused = true; // Use this option if you want to pause on click on "Previous" button
                showSlide();
            });

            // Function to display slide
            async function showSlide() {
                container.innerHTML = "";   // remove previous image
                const slide = slides[current];
                if (slide.image) {
                    container.appendChild(slide.image);
                } else if (slide.video) {
                    const video = document.createElement("video");
                    video.src = slide.video;
                    Object.assign(video, { autoplay: true, muted: true, controls: false });
                    container.appendChild(video);
                    await playVideo(video); // wait until video finishes
                }
            }

            // Loop through slides
            while (true) {
                if (!paused) {
                    await showSlide();
                    const slide = slides[current];
                    if (slide.image) await sleep(slide.duration || defaultDelay);
                    current = (current + 1) % slides.length; // Learn: The modulo operator (%) wraps the index back to 0 when it reaches the end.
                } else {
                    await sleep(200); // small delay while paused
                }
            }
        }
    </script>

    <style>
        #slideshow>img {
            width: 100%;
            max-height: 90vh;
        }

        #slideshow>video {
            width: 100%;
            max-height: 75vh;
        }

        /* For quick testing of video sizes for images & videos */
        /* img {
            width: 100%;
            max-height: 90vh;
        }
        video {
            width: 100%;
            max-height: 90vh;
        } */


        .goToFullscreenContainer {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
        }

        .slideshow-controls-container {
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
        }

        #pauseBtn {
            margin: 0px 10px;
        }

        #prevBtn,
        #pauseBtn,
        #nextBtn {
            padding: 5px 20px;
            border-radius: 5px;
            border-color: lightblue;
            outline: none;
        }

        #goToFullscreen {
            padding: 5px 20px;
            border-radius: 5px;
            border-color: lightblue;
            outline: none;
        }
    </style>
</body>

</html>